{{template "layout" .}}

{{define "title"}}perf-test - Results{{end}}

{{define "content"}}
<h1>{{.TestRun.Config.Name}}
    {{if eq .TestRun.Status "completed"}}<span class="badge badge-completed">completed</span>
    {{else if eq .TestRun.Status "failed"}}<span class="badge badge-failed">failed</span>
    {{else if eq .TestRun.Status "stopped"}}<span class="badge badge-stopped">stopped</span>{{end}}
</h1>

{{if .TestRun.Error}}
<div class="errors">
    <strong>Test error:</strong> {{.TestRun.Error}}
</div>
{{end}}

{{if .Stats}}
<div class="stats-grid">
    <div class="stat-box">
        <div class="value">{{fmtElapsed .Stats.Elapsed}}</div>
        <div class="label">Duration</div>
    </div>
    <div class="stat-box">
        <div class="value">{{.Stats.TotalRequests}}</div>
        <div class="label">Total Requests</div>
    </div>
    <div class="stat-box">
        <div class="value">{{.Stats.SuccessCount}}</div>
        <div class="label">Success</div>
    </div>
    <div class="stat-box">
        <div class="value">{{.Stats.ErrorCount}}</div>
        <div class="label">Errors ({{fmtPct .Stats.ErrorCount .Stats.TotalRequests}}%)</div>
    </div>
    <div class="stat-box">
        <div class="value">{{fmtFloat .Stats.RPS}}</div>
        <div class="label">Avg RPS</div>
    </div>
</div>

<div class="card">
    <h2>Latency Summary</h2>
    <table>
        <thead>
            <tr>
                <th>Metric</th>
                <th class="num">p50</th>
                <th class="num">p90</th>
                <th class="num">p95</th>
                <th class="num">p99</th>
                <th class="num">Min</th>
                <th class="num">Max</th>
                <th class="num">Avg</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Latency</td>
                <td class="num">{{fmtDuration .Stats.P50}}</td>
                <td class="num">{{fmtDuration .Stats.P90}}</td>
                <td class="num">{{fmtDuration .Stats.P95}}</td>
                <td class="num">{{fmtDuration .Stats.P99}}</td>
                <td class="num">{{fmtDuration .Stats.Min}}</td>
                <td class="num">{{fmtDuration .Stats.Max}}</td>
                <td class="num">{{fmtDuration .Stats.Avg}}</td>
            </tr>
        </tbody>
    </table>
</div>

{{if .Stats.PerEndpoint}}
<div class="card">
    <h2>Per-Endpoint Breakdown</h2>
    <table>
        <thead>
            <tr>
                <th>Endpoint</th>
                <th class="num">Reqs</th>
                <th class="num">Errors</th>
                <th class="num">p50</th>
                <th class="num">p90</th>
                <th class="num">p95</th>
                <th class="num">p99</th>
                <th class="num">Avg</th>
            </tr>
        </thead>
        <tbody>
            {{range $name, $ep := .Stats.PerEndpoint}}
            <tr>
                <td>{{$name}}</td>
                <td class="num">{{$ep.TotalRequests}}</td>
                <td class="num">{{$ep.ErrorCount}}</td>
                <td class="num">{{fmtDuration $ep.P50}}</td>
                <td class="num">{{fmtDuration $ep.P90}}</td>
                <td class="num">{{fmtDuration $ep.P95}}</td>
                <td class="num">{{fmtDuration $ep.P99}}</td>
                <td class="num">{{fmtDuration $ep.Avg}}</td>
            </tr>
            {{end}}
        </tbody>
    </table>
</div>
{{end}}
{{else}}
<div class="card">
    <p>No stats available for this test.</p>
</div>
{{end}}

<div class="actions">
    <a href="/configure" class="btn btn-success">New Test</a>
    <a href="/" class="btn btn-outline">Dashboard</a>
</div>
{{end}}
